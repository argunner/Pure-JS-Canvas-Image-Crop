function init(){return canvas=document.getElementById("canvas"),canvas.setAttribute("style","border:1px solid black;"),canvas.getContext?ctx=canvas.getContext("2d"):alert("Fella Sorry to Say that your browser does not support Canvas"),image=document.getElementById("this"),ctx.drawImage(image,0,0,300,300),canvas.addEventListener("mousedown",trigger_mousedown,!1),canvas.addEventListener("mousemove",trigger_watch_cursor,!1),setInterval(draw,10)}function drawCircle(e,o,t){ctx.fillStyle="#FF0000",ctx.beginPath(),ctx.arc(e,o,t,0,2*Math.PI),ctx.fill()}function drawHandles(){drawCircle(ourObject.x,ourObject.y,closeEnough),drawCircle(ourObject.x+ourObject.width,ourObject.y,closeEnough),drawCircle(ourObject.x+ourObject.width,ourObject.y+ourObject.height,closeEnough),drawCircle(ourObject.x,ourObject.y+ourObject.height,closeEnough)}function draw(){clear_screen(),ctx.fillStyle="rgba(255, 255, 255, 0.5)",ctx.fillRect(ourObject.x,ourObject.y,ourObject.width,ourObject.height),ctx.stroke(),drawHandles()}function clear_screen(){ctx.clearRect(0,0,canvas.width,canvas.height);var e=document.getElementById("this");ctx.drawImage(e,0,0,300,300)}function trigger_mousedown(e){mx=e.clientX,my=e.clientY,mouseX=mx-canvas.offsetLeft,mouseY=my-canvas.offsetTop,mouseX>ourObject.x&&mouseX<ourObject.x+ourObject.width&&mouseY>ourObject.y&&mouseY<ourObject.y+ourObject.height&&(dragging=!0,ourObject.x=mouseX,ourObject.y=mouseY,canvas.removeEventListener("mousedown",trigger_mousedown,!1),window.addEventListener("mousemove",trigger_mousemove),window.addEventListener("mouseup",trigger_mouseup)),mouseX>ourObject.x-closeEnough&&mouseX<ourObject.x&&mouseY>ourObject.y-closeEnough&&mouseY<ourObject.y}function trigger_mouseup(e){canvas.addEventListener("mousemove",trigger_watch_cursor,!1),canvas.addEventListener("mousedown",trigger_mousedown,!1),window.removeEventListener("mouseup",trigger_mouseup,!1),window.removeEventListener("mousemove",trigger_mousemove,!1),dragging&&(dragging=!1),crop(e)}function trigger_watch_cursor(e){mx=e.clientX,my=e.clientY,mouseX=mx-canvas.offsetLeft,mouseY=my-canvas.offsetTop,mouseX>ourObject.x&&mouseX<ourObject.x+ourObject.width&&mouseY>ourObject.y&&mouseY<ourObject.y+ourObject.height?document.body.style.cursor="move":mouseX>ourObject.x-closeEnough&&mouseX<ourObject.x&&mouseY>ourObject.y-closeEnough&&mouseY<ourObject.y?(document.body.style.cursor="se-resize",drag_se=!0,canvas.addEventListener("mousedown",press_handle,!1)):mouseX>ourObject.x+ourObject.width&&mouseX<ourObject.x+ourObject.width+closeEnough&&mouseY>ourObject.y-closeEnough&&mouseY<ourObject.y?(document.body.style.cursor="sw-resize",drag_se=!0,canvas.addEventListener("mousedown",press_handle,!1)):mouseX>ourObject.x+ourObject.width&&mouseX<ourObject.x+ourObject.width+closeEnough&&mouseY>ourObject.y+ourObject.height&&mouseY<ourObject.y+ourObject.height+closeEnough?(document.body.style.cursor="nw-resize",drag_nw=!0,canvas.addEventListener("mousedown",press_handle,!1)):mouseX>ourObject.x-closeEnough&&mouseX<ourObject.x&&mouseY>ourObject.y+ourObject.height&&mouseY<ourObject.y+ourObject.height+closeEnough?(document.body.style.cursor="ne-resize",drage_ne=!0,canvas.addEventListener("mousedown",press_handle,!1)):document.body.style.cursor="default"}function press_handle(){canvas.removeEventListener("mousemove",trigger_mousemove,!1),canvas.addEventListener("mousemove",drag_handle,!1)}function drag_handle(e){mx=e.clientX,my=e.clientY,mouseX=mx-canvas.offsetLeft,mouseY=my-canvas.offsetTop,canvas.addEventListener("mouseup",drag_handle_done,!1),drag_se?(ourObject.height+=ourObject.y-mouseY,ourObject.width+=ourObject.x-mouseX,ourObject.x=mouseX,ourObject.y=mouseY):drag_ne&&(ourObject.height+=ourObject.y-mouseY,ourObject.width+=ourObject.x-mouseX,ourObject.x=mouseX,ourObject.y=mouseY)}function drag_handle_done(){canvas.removeEventListener("mousedown",press_handle,!1),canvas.removeEventListener("mousemove",drag_handle,!1),canvas.removeEventListener("mouseup",drag_handle_down,!1),canvas.addEventListener("mousemove",trigger_mousemove,!1),drag_se=!1,drag_ne=!1,drag_sw=!1,drag_nw=!1}function trigger_mousemove(e){canvas.removeEventListener("mousemove",trigger_watch_cursor,!1),dragging&&(ourObject.x=e.clientX-canvas.offsetLeft,ourObject.y=e.clientY-canvas.offsetTop)}function crop(){var e=document.getElementById("image_skel"),o=document.getElementById("preview");if(o.setAttribute("style","border:1px solid black;"),e.setAttribute("style","border:1px solid black; display:none;"),e.getContext)var t=e.getContext("2d");else alert("Fella Sorry to Say that your browser does not support Canvas");if(o.getContext)var r=o.getContext("2d");else alert("Fella Sorry to Say that your browser does not support Canvas");image=document.getElementById("this");var s=ourObject.x,u=ourObject.y,n=ourObject.width,c=ourObject.height;t.drawImage(image,0,0,300,300),image_skeleton=new Image,image_skeleton.src=e.toDataURL("image/png"),r.drawImage(image_skeleton,s,u,n,c,0,0,300,300),clear_screen()}var ourObject={x:100,y:100,width:70,height:70},closeEnough=5,mx,my,mouseX,mouseY,dragging=!1,drag_pos_x,drag_pos_y,drag_se=!1,drag_sw=!1,drag_nw=!1,drag_ne=!1,canvas,ctx,x,y,image,image_new,image_div=document.getElementsByName("prev"),image_skeleton;image_div||alert("NULL"),window.onload=function(){init()};
